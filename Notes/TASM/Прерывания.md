## Description
**Прерывания** - это специальные команды, которые позволяют программе обращаться к операционной системе или другим службам для выполнения определенных задач. Прерывания могут быть вызваны программой или аппаратными устройствами, такими как таймеры или клавиатура. 

- [[Прерывания#int 21h|int 21h]]
- [[Прерывания#int 10h|int 10h]]
- [[Прерывания#int 16h|int 16h]]

## In-depth
#### int 21h
– это прерывание, которое используется в программировании на ассемблере для вызова системных функций операционной системы DOS. Оно позволяет программе взаимодействовать с операционной системой, выполнять различные операции ввода-вывода, работать с файлами и т.д.

Для вызова прерывания int 21h необходимо использовать команду `int` с указанием номера прерывания в регистре `ah` и необходимых параметров в других регистрах.

```TASM
mov ah, [номер прерывания]
int 21h
```

##### Номера прерываний
**01h**  – keyboard input a single char
```TASM
    mov ah, 01h     ; Загружаем номер функции 01h в регистр AH
    int 21h         ; Вызываем прерывание INT 21h
					; Результат записывается в al
```
**02h** – display output a single char ^d164c7
```TASM
    mov dl, 'A'       ; Загружаем символ 'A' в регистр DL
    mov ah, 02h       ; Загружаем номер функции 02h в регистр AH
    int 21h           ; Вызываем прерывание INT 21h
```

^afd92f

**03h** – auxiliary input
```TASM
    mov ah, 03h      ; Загружаем номер функции 03h в регистр AH
    mov bh, 0        ; Устанавливаем номер страницы экрана в 0
    mov bl, 0        ; Устанавливаем атрибут экрана (цвет) в 0
    mov dh, 0        ; Устанавливаем начальную строку курсора в 0
    mov dl, 0        ; Устанавливаем начальную колонку курсора в 0
    int 21h          ; Вызываем прерывание INT 21h
```
**04h** – auxiliary output
```TASM
mov ah, 04h      ; Load function code 04h into the AH register 
mov al, 1        ; Auxiliary device number (e.g., 1 for LPT1) 
lea dx, myString ; Load the address of the string into DX 
int 21h          ; Call INT 21h to send the string to the auxiliary device
```
**05h** – printer output
```TASM
mov ah, 05h            ; Function code 05h in AH 
mov dl, char_to_print  ; Load the character to be printed in DL 
int 21h                ; Call INT 21h to send the character to the printer
```
**06h** – direct console input
```TASM
mov ah, 06h          ; Function code 06h in AH 
lea dx, char_input   ; Address of the input buffer in DX 
mov dl, 1            ; Maximum characters to read 
int 21h              ; Call INT 21h to read a character from the console
```
**07h** – direct console input without echo
```TASM
mov ah, 07h          ; Function code 07h in AH 
lea dx, char_input   ; Address of the input buffer in DX 
mov dl, 1            ; Maximum characters to read (1 character in this case) 
int 21h              ; Call INT 21h to read a character without echoing it
; now char_input contains entered string
```
**08h** – console input with echo
```TASM
mov ah, 08h                 ; Function code 08h in AH 
mov dx, offset input_buffer ; Address of the input buffer 
mov cx, max_length          ; Maximum characters to read 
int 21h 
; Now the entered string is in input_buffer
```
**09h** – display string
```TASM
mov ah, 09h            ; Function code 09h (display string) in AH 
lea dx, input_buffer   ; Load the address of the input buffer 
int 21h
```

^1b7bae

**0ah** – buffered input
```TASM
mov ah, 0Ah                   
mov dx, offset input_buffer  ; Address of the input buffer 
mov al, max_length           ; Maximum characters to read 
int 21h
; now the entered string in input_buffer
```


###### work with files
in order to define path variable NULL (0) has to be placed at the and of the file path string
```TASM
filepath db 'path\data.txt', 0
```

**3ch** – create file
```TASM
filehandle dw 0
---
mov ah, 3Ch              ; Код функции для открытия файла
mov dx, offset filename  ; Указатель на строку с именем файла
int 21h                  ; Вызов прерывания для открытия файла
jc open_error            ; Если CF установлен, произошла ошибка
mov [file_handle], ax    ; Сохранение дескриптора файла
```
**3dh** – open file
```TASM
mov ah, 3Dh              ; Код функции для открытия файла
mov dx, offset filename  ; Указатель на строку с путем файла
int 21h                  ; Вызов прерывания для открытия файла
jc open_error            ; Если CF установлен, произошла ошибка
mov [file_handle], ax    ; Сохранение дескриптора файла
```
**3fh** – read file
```TASM
mov ah, 3Fh             ; Код функции для чтения из файла
mov bx, [file_handle]   ; Дескриптор открытого файла
mov dx, offset buffer   ; Указатель на буфер для чтения данных
mov cx, buffer_size     ; Размер буфера для чтения
int 21h                 ; Вызов прерывания для чтения из файла
jc read_error           ; Если CF установлен, произошла ошибка
```
**40h** – write to file
```TASM
mov ah, 40h           ; Код функции для записи в файл
mov bx, [file_handle] ; Дескриптор открытого файла
mov dx, offset data   ; Указатель на данные для записи
mov cx, data_length   ; Длина данных
int 21h               ; Вызов прерывания для записи в файл
jc write_error        ; Если CF установлен, произошла ошибка
```
**3eh** – close file
```TASM
mov ah, 3Eh            ; Код функции для закрытия файла
mov bx, [file_handle]  ; Дескриптор открытого файла
int 21h                ; Вызов прерывания для закрытия файла
jc close_error         ; Если CF установлен, произошла ошибка
```


#### int 10h
– это прерывание BIOS, которое используется для ввода-вывода данных. Оно позволяет программе общаться с устройствами ввода-вывода, такими как клавиатура, экран и принтер.
Для вызова этого прерывания нужно определить регистры, которые будут использоваться для передачи параметров в прерывание `int 10h`. Обычно это регистр `AH` для кода функции и регистры `AL`, `BH`, `BL`, `CH`, `CL`, `DH`, `DL` для передачи других параметров.
```TASM
mov ah, [код функции]
mov [регистр], [параметр]
...
int 10h 
```
	
| код функции                    | параметры                                                                                                                                                      | назначение                                          | возвращаемые значения                                                                                                                              |
| ------------------------------ | -------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------- |
| 00h                            | —                                                                                                                                                              | установка видеорежима                               | al - флаг видеорежима                                                                                                                              |
| 01h                            | ch - начальная строка, cl - конечная строка                                                                                                                    | установка конфигурации курсора                      | —                                                                                                                                                  |
| 02h                            | bh - страница, dh - строка, dl - столбец                                                                                                                       | установка позиции курсора                           | —                                                                                                                                                  |
| 03h                            | bh - страница                                                                                                                                                  | получение положения курсора                         | AX = 0, CH = начальная строка формы курсора, CL = конечная строка формы курсора, DH = строка, DL = столбец                                         |
| 04h                            | —                                                                                                                                                              | чтение положения светового пера                     | AH = Статус (0=не активно, 1=активно), BX = пиксель X, CH = пиксель Y, CX = номер строки пикселя для режимов 0Fh-10h, DH = символ Y, DL = символ X |
| 05h                            | AL = номер страницы                                                                                                                                            | выбор активной страницы                             | —                                                                                                                                                  |
| 06h                            | AL = число строк для прокрутки, BH = атрибут цвета, CH = номер верхней строки, CL = номер левого столбца, DH = номер нижней строки, DL = номер правого столбца | прокрутка активной страницы экрана вверх            | —                                                                                                                                                  |
| 07h                            | ^^^                                                                                                                                                            | прокрутка активной страницы экрана вниз             | —                                                                                                                                                  |
| 08h                            | bh - страница                                                                                                                                                  | чтение символа и атрибута в текущей позиции курсора | AH = цвет, AL = символ                                                                                                                             |
| 09h                            | AL = символ, BH = страница, BL = цвет, CX = сколько раз записать символ                                                                                        | запись символа и атрибута в текущую позицию курсора |                                                                                                                                                    |
| 0ah                            | AL = символ, BH = страница, CX = сколько раз записать символ.                                                                                                  | запись символа в текущую позицию курсора            |                                                                                                                                                    |
| 0bh (bh = 00h)                 | BL = Цвет фона/границы (граница только в текстовых режимах)                                                                                                    | задание цвета фона или границы                      |                                                                                                                                                    |
| 0bh (bh = 01h) BL = ID палитры | BL = ID палитры                                                                                                                                                | задание палитры цветов                              |                                                                                                                                                    |
| 0ch                            | AL = цвет, BH = страница, CX = x, DX = y                                                                                                                       | изображение точки                                   |                                                                                                                                                    |
| 0dh                            | BH = страница, CX = x, DX = y                                                                                                                                  | чтение позиции и атрибута пикселя                   | AL - цвет пикселя                                                                                                                                  |
| 0eh                            | AL = символ, BH = страница, BL = цвет (только в графическом режиме)                                                                                            | консольный вывод символа                            |                                                                                                                                                    |
| 0fh                            |                                                                                                                                                                | получение видеорежима                               | AL = видеорежим, AH = число знаковых столбцов, BH = текущая страница                                                                               |



**Видеорежимы:**

| номер | разрешение | режим                                           |
| ----- | ---------- | ----------------------------------------------- |
| 1h    | 40x25      | текстовый режим с 16 цветами                    |
| 2h    | 40x25      | текстовый режим с 16 цветами и монитором CGA    |
| 3h    | 80x25      | текстовый режим с 16 цветами                    |
| 4h    | 80x25      | текстовый режим с 16 цветами и монитором CGA    |
| 5h    | 320x200    | графический режим с 4 цветами                   |
| 6h    | 320x200    | графический режим с 4 цветами и монитором CGA   |
| 7h    | 320x200    | графический режим с 4 цветами и монитором EGA   |
| 8h    | 640x200    | графический режим с 2 цветами                   |
| 9h    | 640x200    | графический режим с 2 цветами и монитором CGA   |
| 10h   | 640x200    | графический режим с 2 цветами и монитором EGA   |
| 11h   | 640x350    | графический режим с 2 цветами                   |
| 12h   | 640x350    | графический режим с 2 цветами и монитором EGA   |
| 13h   | 640x480    | графический режим с 2 цветами                   |
| 14h   | 640x480    | графический режим с 2 цветами и монитором EGA   |
| 15h   | 320x200    | графический режим с 16 цветами                  |
| 16h   | 320x200    | графический режим с 16 цветами и монитором VGA  |
| 17h   | 640x200    | графический режим с 16 цветами                  |
| 18h   | 640x200    | графический режим с 16 цветами и монитором VGA  |
| 19h   | 640x350    | графический режим с 16 цветами                  |
| 20h   | 640x350    | графический режим с 16 цветами и монитором VGA  |
| 21h   | 640x480    | графический режим с 16 цветами                  |
| 22h   | 640x480    | графический режим с 16 цветами и монитором VGA  |
| 23h   | 320x200    | графический режим с 256 цветами                 |
| 24h   | 320x200    | графический режим с 256 цветами и монитором VGA |
| 25h   | 640x200    | графический режим с 256 цветами                 |
| 26h   | 640x200    | графический режим с 256 цветами и монитором VGA |
| 27h   | 640x350    | графический режим с 256 цветами                 |
| 28h   | 640x350    | графический режим с 256 цветами и монитором VGA |
| 29h   | 640x480    | графический режим с 256 цветами                 |
| 30h   | 640x480    | графический режим с 256 цветами и монитором VGA |

#### int 16h
Прерывание int 16h в TASM используется для работы с клавиатурой и мышью.

При вызове этого прерывания происходит проверка наличия нажатой клавиши или движения мыши. Если нажата клавиша, то ее код помещается в регистр AH, а ASCII-код символа – в AL. Если произошло движение мыши, то ее координаты помещаются в регистры CX и DX.

Прерывание int 16h имеет несколько подфункций, которые определяют, какие действия будут выполнены при его вызове. Например:

| номер прерывания | назначение                                               |
| ---------------- | -------------------------------------------------------- |
| 00h              | проверка наличия нажатой клавиши или движения мыши       |
| 01h              | ожидание нажатия клавиши                                 |
| 02h              | чтение символа с клавиатуры без ожидания нажатия клавиши |
| 03h              | чтение состояния клавиатуры                              |
| 04h              | чтение состояния мыши                                    |
| 05h              | установка курсора мыши                                   |
| 06h              | чтение позиции курсора мыши                              |
| 07h              | чтение состояния кнопок мыши                             |
| 08h              | чтение позиции и состояния мыши                          |


Для использования прерывания int 16h необходимо подключить библиотеку "interrpt.lib" и объявить соответствующие подфункции в секции .data:

```TASM
extrn int16h00h:proc
extrn int16h01h:proc
extrn int16h02h:proc
extrn int16h03h:proc
extrn int16h04h:proc
extrn int16h05h:proc
extrn int16h06h:proc
extrn int16h07h:proc
extrn int16h08h:proc
```

Затем можно вызывать нужную подфункцию, передавая ей необходимые параметры. Например, для ожидания нажатия клавиши можно использовать следующий код:

```TASM
mov ah, 01h ; подфункция 01h - ожидание нажатия клавиши
int 16h ; вызов прерывания int 16h
```
этого в регистре AH будет содержаться код нажатой клавиши, а в AL - ASCII-код символа