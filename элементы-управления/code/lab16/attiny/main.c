/*
 * GccApplication14.c
 *
 * Created: 4/23/2025 5:55:21 AM
 * Author : roman
 */ 


#include "main.h"

void port_ini(void)
{
	PORTD=0x00;
	DDRD=0xFF;
}
//----------------------------------------
void SPI_init(void)
{
	DDRB|=((1<<PB4)|(1<<PB6)|(1<<PB7));//????? USI ?? ?????
	DDRB&=~(1<<PB5);//????? DI ?? ?????
	PORTB&=~((1<<PB4)|(1<<PB6)|(1<<PB7));//????? USI ? ?????? ???????
}
//----------------------------------------
char SPI_ChangeByte(char byte)
{
	USIDR = byte; //?????? ? ???????
	USISR |= (1<<USIOIF);//????????? ???? ?????? ????????
	while(!(USISR & (1<<USIOIF)))
	{
		USICR |= ((1<<USIWM0)|(1<<USICS1)|(1<<USICLK)|(1<<USITC));//?????????? ???????? ????
		_delay_us(10);
	}
	return USIDR;
}
//----------------------------------------
int main(void)
{
	char str[4];
	unsigned char n=0,m=0;//?????????? ??? ?????????? ?????
	port_ini(); //?????????????? ?????
	LCD_ini();  //?????????????? ???????
	SPI_init(); //?????????????? ????
	clearlcd();
	setpos(0,0);
	str_lcd("Hello World!");
	_delay_ms(1000);
	setpos(2,1);
	str_lcd("String 2");
	_delay_ms(1000);
	while(1)
	{
// 		clearlcd();
// 		setpos(0,0);
// 		n= (unsigned char) rand() % 256;
// 		//n = 0b10101010;
// 		m = SPI_ChangeByte(n);
// 		itoa(n,str,10);
// 		str_lcd(str);
// 		itoa(m,str,10);
// 		setpos(0,1);
// 		str_lcd(str);
// 		_delay_ms(1000);
	}
}
